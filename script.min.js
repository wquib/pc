var playerName=0;let jailtime_total=0,fine_total=0,bail_total=0,max_jailtime=480,max_fine=1e4,max_bail=25e3,chargeData=[];async function loadTableData(){let e=await fetch("data.json");chargeData=await e.json();let t=document.getElementById("chargeTableBody");t.innerHTML="",chargeData.forEach((e,a)=>{var n=splitChargeCode(e.charge).Code,l=splitChargeCode(e.charge).Charge,r=parseFloat(e.fine).toLocaleString("en-US",{style:"currency",currency:"USD"}),o=parseFloat(e.bail).toLocaleString("en-US",{style:"currency",currency:"USD"});let i=document.createElement("tr");i.innerHTML=`
            <td hidden translate="no">${a}</td>
            <td hidden translate="no">${e.code}</td>
            <td translate="no" onclick="copyPureCharge(${a})" class="selectable-text">${n}</td>
            <td translate="no" link>${l} 
                <a href="https://police.san-andreas.net/viewtopic.php?t=148639#:~:text=${n}" target="_blank" rel="noopener noreferrer">
                    <i class="bi bi-link-45deg"></i>
                </a>
            </td>
            <td translate="no">${e.jailtime}</td>
            <td translate="no">${r}</td>
            <td translate="no">${o}</td>
            <td><button onclick="AddCharge(${a})" class="btn btn-primary">ADD</button></td>
        `,t.appendChild(i)})}function AddCharge(e){let t=chargeData[e],a=document.querySelectorAll(".index");for(let n of a){let l=parseFloat(n.textContent);if(l===e){console.log("Data sudah ada di tabel seleksi.");return}}let r=document.getElementById("selectedChargeTableBody");var o=document.createElement("tr"),i=splitChargeCode(t.charge).Code,c=splitChargeCode(t.charge).Charge,d=parseFloat(t.fine).toLocaleString("en-US",{style:"currency",currency:"USD"}),s=parseFloat(t.bail).toLocaleString("en-US",{style:"currency",currency:"USD"});o.innerHTML=`
        <td translate="no" class="index" hidden>${e}</td>
        <td translate="no">${i}</td>
        <td translate="no" id="charge-${e}" onclick="copyCharge(${e})" class="selectable-text">${c}</td>
        <td translate="no" class="jailtime">${t.jailtime}</td>
        <td translate="no" class="fine">${d}</td>
        <td translate="no" class="bail">${s}</td>
        <td>
            <button onclick="copyCharge(${e})" class="btn btn-secondary me-3">COPY</button>
            <button onclick="removeCharge(this)" class="btn btn-danger">REMOVE</button>
        </td>
    `,r.appendChild(o),refreshData()}function removeCharge(e){let t=e.closest("tr");t.remove(),refreshData()}function resetCharge(){let e=document.getElementById("selectedChargeTableBody");e.innerHTML="",refreshData()}function refreshData(){jailtime_total=0,fine_total=0,bail_total=0;let e=document.querySelectorAll(".jailtime");e.forEach(e=>{jailtime_total+=parseInt(e.textContent,10)}),jailtime_total>max_jailtime&&(jailtime_total=max_jailtime),document.getElementById("jailtime-total").textContent=jailtime_total;let t=document.querySelectorAll(".fine");t.forEach(e=>{let t=parseFloat(e.textContent.replace("$","").replace(",",""));fine_total+=t}),fine_total>max_fine&&(fine_total=max_fine),document.getElementById("fine-total").textContent=`${fine_total.toLocaleString("en-US",{style:"currency",currency:"USD"})}`;let a=document.querySelectorAll(".bail");a.forEach(e=>{let t=parseFloat(e.textContent.replace("$","").replace(",",""));bail_total+=t}),bail_total>max_bail&&(bail_total=max_bail),document.getElementById("bail-total").textContent=`${bail_total.toLocaleString("en-US",{style:"currency",currency:"USD"})}`;let n=`/arrest ${playerName} ${jailtime_total} ${fine_total} ${bail_total}`;document.getElementById("arrest-command").textContent=n}function updateName(e){playerName="string"==typeof e?e.replace(/ /g,"_"):e;let t=`/arrest ${playerName} ${jailtime_total} ${fine_total} ${bail_total}`;document.getElementById("arrest-command").textContent=t}function copyCharge(e){var t=document.getElementById(`charge-${e}`);let a=chargeData[e],n=`/su ${playerName} ${a.charge}`,l=document.createElement("textarea");l.value=n,document.body.appendChild(l),l.select();try{document.execCommand("copy"),t.classList.add("fw-bold")}catch(r){console.error("Gagal menyalin teks",r)}document.body.removeChild(l)}function copyPureCharge(e){let t=chargeData[e];var a=document.createElement("textarea");a.value=t.charge,document.body.appendChild(a),a.select();try{document.execCommand("copy")}catch(n){alert("Failed to copy text")}document.body.removeChild(a)}function copyArrestCMD(){var e=document.getElementById("arrest-command").innerText.trim(),t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(a){alert("Failed to copy text")}document.body.removeChild(t)}function splitChargeCode(e){let t=e.match(/^\((\d+)\) ([A-Z]\.)/);if(!t)return{error:"Input format is incorrect"};{let a=t[0],n=e.replace(a,"").trim();return{Code:a,Charge:n}}}document.addEventListener("DOMContentLoaded",loadTableData),document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("playerName");e.addEventListener("input",function(){var t=e.value.trim();""===t&&(t=0),updateName(t)})}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("searchInput"),t=document.getElementById("chargeTable"),a=t.getElementsByTagName("tr");e.addEventListener("keyup",function(){let t=e.value.toLowerCase();for(let n=1;n<a.length;n++){let l=a[n].cells[1].textContent||a[n].cells[1].innerText,r=a[n].cells[2].textContent||a[n].cells[2].innerText,o=a[n].cells[3].textContent||a[n].cells[3].innerText;l.toLowerCase().indexOf(t)>-1||r.toLowerCase().indexOf(t)>-1||o.toLowerCase().indexOf(t)>-1?a[n].style.display="":a[n].style.display="none"}})}),document.addEventListener("DOMContentLoaded",e=>{let t=document.getElementById("searchInput"),a=document.getElementById("playerName");document.addEventListener("keydown",e=>{e.ctrlKey&&"k"===e.key&&(e.preventDefault(),t.focus()),e.ctrlKey&&"s"===e.key&&(e.preventDefault(),a.focus())})});