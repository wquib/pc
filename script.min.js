var playerName=0;let jailtime_total=0,fine_total=0,bail_total=0,max_jailtime=480,max_fine=1e4,max_bail=25e3,addedChargeData=[],chargeData=[];async function loadTableData(){let e=await fetch("data.json");chargeData=await e.json();let t=document.getElementById("chargeTableBody");t.innerHTML="",chargeData.forEach((e,a)=>{var l=splitChargeCode(e.charge).Code,n=splitChargeCode(e.charge).Charge,r=parseFloat(e.fine).toLocaleString("en-US",{style:"currency",currency:"USD"}),d=parseFloat(e.bail).toLocaleString("en-US",{style:"currency",currency:"USD"});let o=document.createElement("tr");o.innerHTML=`
            <td hidden translate="no">${a}</td>
            <td hidden translate="no">${e.code}</td>
            <td translate="no" onclick="copyPureCharge(${a})" class="selectable-text">${l}</td>
            <td translate="no">${n} 
                <a href="https://police.san-andreas.net/viewtopic.php?t=148639#:~:text=${l}" target="_blank" rel="noopener noreferrer">
                    <i class="bi bi-link-45deg"></i>
                </a>
            </td>
            <td translate="no">${e.jailtime}</td>
            <td translate="no">${r}</td>
            <td translate="no">${d}</td>
            <td><button onclick="AddCharge(${a})" class="btn btn-primary add-btn" id="add-btn-${a}">ADD</button></td>
        `,t.appendChild(o)}),loadChargeTable()}async function loadChargeTable(){if(null!==sessionStorage.getItem("addedCharge")){addedChargeData=JSON.parse(sessionStorage.getItem("addedCharge"));for(let e=0;e<addedChargeData.length;e++){let t=addedChargeData[e];AddCharge(t,!1)}}}function AddCharge(e,t=!0){document.getElementById("add-btn-"+e).disabled=!0;let a=chargeData[e],l=document.querySelectorAll(".index");for(let n of l){let r=parseFloat(n.textContent);if(r===e){console.log("Data sudah ada di tabel seleksi.");return}}let d=document.getElementById("selectedChargeTableBody");var o=document.createElement("tr"),i=splitChargeCode(a.charge).Code,c=splitChargeCode(a.charge).Charge,s=parseFloat(a.fine).toLocaleString("en-US",{style:"currency",currency:"USD"}),g=parseFloat(a.bail).toLocaleString("en-US",{style:"currency",currency:"USD"});if(o.innerHTML=`
        <td translate="no" class="index" hidden>${e}</td>
        <td translate="no">${i}</td>
        <td translate="no" id="charge-${e}" onclick="copyCharge(${e})" class="selectable-text charge-td">${c}</td>
        <td translate="no" class="jailtime">${a.jailtime}</td>
        <td translate="no" class="fine">${s}</td>
        <td translate="no" class="bail">${g}</td>
        <td>
            <button onclick="copyCharge(${e})" class="btn btn-secondary me-2">COPY</button>
            <button onclick="removeCharge(this, '${e}')" class="btn btn-danger">REMOVE</button>
        </td>
    `,!0===t){addedChargeData.push(e);let h=JSON.stringify(addedChargeData);sessionStorage.setItem("addedCharge",h)}d.appendChild(o),refreshData()}function removeCharge(e,t){let a=parseInt(t,10);if((addedChargeData=addedChargeData.filter(e=>e!==a)).length>0){let l=JSON.stringify(addedChargeData);sessionStorage.setItem("addedCharge",l)}else sessionStorage.removeItem("addedCharge");document.getElementById("add-btn-"+t).disabled=!1;let n=e.closest("tr");n.remove(),refreshData()}function resetCharge(){let e=document.querySelectorAll(".add-btn");e.forEach(function(e){!0===e.disabled&&(e.disabled=!1)}),addedChargeData=[],sessionStorage.removeItem("addedCharge");let t=document.getElementById("selectedChargeTableBody");t.innerHTML="",refreshData()}function refreshData(){jailtime_total=0,fine_total=0,bail_total=0;let e=document.querySelectorAll(".jailtime");e.forEach(e=>{jailtime_total+=parseInt(e.textContent,10)}),jailtime_total>max_jailtime&&(jailtime_total=max_jailtime),document.getElementById("jailtime-total").textContent=jailtime_total;let t=document.querySelectorAll(".fine");t.forEach(e=>{let t=parseFloat(e.textContent.replace("$","").replace(",",""));fine_total+=t}),fine_total>max_fine&&(fine_total=max_fine),document.getElementById("fine-total").textContent=`${fine_total.toLocaleString("en-US",{style:"currency",currency:"USD"})}`;let a=document.querySelectorAll(".bail");a.forEach(e=>{let t=parseFloat(e.textContent.replace("$","").replace(",",""));bail_total+=t}),bail_total>max_bail&&(bail_total=max_bail),document.getElementById("bail-total").textContent=`${bail_total.toLocaleString("en-US",{style:"currency",currency:"USD"})}`;let l=`/arrest ${playerName} ${jailtime_total} ${fine_total} ${bail_total}`;document.getElementById("arrest-command").textContent=l}function updateName(e){playerName="string"==typeof e?e.replace(/ /g,"_"):e;let t=`/arrest ${playerName} ${jailtime_total} ${fine_total} ${bail_total}`;document.getElementById("arrest-command").textContent=t}function copyCharge(e){var t=document.getElementById(`charge-${e}`);let a=chargeData[e],l=`/su ${playerName} ${a.charge}`,n=document.createElement("textarea");n.value=l,document.body.appendChild(n),n.select();try{document.execCommand("copy"),t.classList.add("fw-bold")}catch(r){console.error("Failed to copy text",r)}document.body.removeChild(n)}function copyPureCharge(e){let t=chargeData[e];var a=document.createElement("textarea");a.value=t.charge,document.body.appendChild(a),a.select();try{document.execCommand("copy")}catch(l){alert("Failed to copy text",l)}document.body.removeChild(a)}function copyArrestCMD(){var e=document.getElementById("arrest-command").innerText.trim(),t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(a){alert("Failed to copy text",a)}document.body.removeChild(t)}function splitChargeCode(e){let t=e.match(/^\((\d+)\) ([A-Z]\.)/);if(!t)return{error:"Input format is incorrect"};{let a=t[0],l=e.replace(a,"").trim();return{Code:a,Charge:l}}}document.addEventListener("DOMContentLoaded",loadTableData),document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("playerName");e.addEventListener("input",function(){var t=e.value.trim();""===t&&(t=0),updateName(t)})}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("searchInput"),t=document.getElementById("chargeTable"),a=t.getElementsByTagName("tr");e.addEventListener("keyup",function(){let t=e.value.toLowerCase();for(let l=1;l<a.length;l++){let n=a[l].cells[1].textContent||a[l].cells[1].innerText,r=a[l].cells[2].textContent||a[l].cells[2].innerText,d=a[l].cells[3].textContent||a[l].cells[3].innerText;n.toLowerCase().indexOf(t)>-1||r.toLowerCase().indexOf(t)>-1||d.toLowerCase().indexOf(t)>-1?a[l].style.display="":a[l].style.display="none"}})}),document.addEventListener("DOMContentLoaded",e=>{let t=document.getElementById("searchInput"),a=document.getElementById("playerName");document.addEventListener("keydown",e=>{e.ctrlKey&&"k"===e.key&&(e.preventDefault(),t.focus()),e.ctrlKey&&"s"===e.key&&(e.preventDefault(),a.focus())})});